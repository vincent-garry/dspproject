{# templates/admin/dashboard.html.twig #}
{% extends 'base.html.twig' %}

{% block title %}Admin Dashboard{% endblock %}

{% block body %}
    <h1>Dashboard Administrateur</h1>

    <h2>Statistiques</h2>
    <ul>
        <li>Nombre total de ticket: {{ stats.totalTickets }}</li>
        <li>Tickets utilisés: {{ stats.usedTickets }}</li>
        <li>Nombre total de prix récupérés: {{ stats.totalPrizes }}</li>
    </ul>
    <!-- Élement canvas pour le graphique -->
    <canvas id="myPieChart"></canvas>

    <h2>Genre statistiques</h2>
    <ul>
        {% for gender, count in stats.genderStats %}
            <li>{{ gender }}: {{ count }}</li>
        {% endfor %}
    </ul>

    <canvas id="genderBarChart"></canvas>

    <a href="{{ path('admin_email_data') }}">Voir les données d'emailing</a>

    <script>
        // Récupération des données de Twig
        const totalTickets = {{ stats.totalTickets|json_encode|raw }};
        const usedTickets = {{ stats.usedTickets|json_encode|raw }};
        const remainingTickets = totalTickets - usedTickets;

        // Configuration du graphique
        const ctx = document.getElementById('myPieChart').getContext('2d');
        const myPieChart = new Chart(ctx, {
            type: 'pie',
            data: {
                labels: ['Tickets restants', 'Tickets utilisés'],
                datasets: [{
                    label: 'Tickets',
                    data: [remainingTickets, usedTickets],
                    backgroundColor: ['#0000FF', '#FF0000'], // Bleu pour les tickets restants, rouge pour les utilisés
                    borderColor: ['#FFFFFF', '#FFFFFF'],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false, // Permet de contrôler la taille via CSS
                plugins: {
                    legend: {
                        position: 'top',
                        labels: {
                            // Taille des labels dans la légende
                            font: {
                                size: 24 // Ajustez la taille de la police selon vos besoins
                            }
                        }
                    },
                    tooltip: {
                        callbacks: {
                            label: function(tooltipItem) {
                                return tooltipItem.label + ': ' + tooltipItem.raw;
                            }
                        }
                    }
                }
            }
        });
    </script>

    <script>
        const chartCanvas = document.getElementById('genderBarChart');
        const chartContext = chartCanvas.getContext('2d');
        const genderStats = {{ stats.genderStats|json_encode|raw }};
        const genderLabels = Object.keys(genderStats);
        const genderData = Object.values(genderStats);

        new Chart(chartContext, {
            type: 'bar',
            data: {
                labels: genderLabels,
                datasets: [{
                    label: 'Nombre par Genre',
                    data: genderData,
                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                    borderColor: 'rgba(75, 192, 192, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        beginAtZero: true,
                        ticks: {
                            // Taille des labels sur l'axe X
                            font: {
                                size: 14 // Ajustez la taille de la police selon vos besoins
                            }
                        }
                    },
                    y: {
                        beginAtZero: true,
                        ticks: {
                            // Taille des labels sur l'axe Y
                            font: {
                                size: 14 // Ajustez la taille de la police selon vos besoins
                            }
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: true,
                        position: 'top',
                        labels: {
                            // Taille des labels dans la légende
                            font: {
                                size: 24 // Ajustez la taille de la police selon vos besoins
                            }
                        }
                    },
                    tooltip: {
                        callbacks: {
                            label: function(tooltipItem) {
                                return tooltipItem.label + ': ' + tooltipItem.raw;
                            }
                        }
                    }
                }
            }
        });
    </script>
{% endblock %}